# GLM-4

<p align="center">
ğŸ‘‹ åŠ å…¥æˆ‘ä»¬çš„ <a href="https://discord.gg/8cnQKdAprg" target="_blank">Discord</a> å’Œ <a href="resources/WECHAT.md" target="_blank"> å¾®ä¿¡ </a>
</p>
<p align="center">
ğŸ“åœ¨ <a href="https://open.bigmodel.cn/?utm_campaign=open&_channel_track_key=OWTVNma9">æ™ºè°±AIå¼€æ”¾å¹³å°</a> ä½“éªŒå’Œä½¿ç”¨æ›´å¤§è§„æ¨¡çš„ GLM å•†ä¸šæ¨¡å‹ã€‚
</p>

Read this in [English](README)

## é¡¹ç›®æ›´æ–°

- ğŸ”¥ğŸ”¥ **News**: ```2025/04/14```: æˆ‘ä»¬å‘å¸ƒ [GLM-4-0414](https://huggingface.co/collections/THUDM/glm-4-0414-67f3cbcb34dd9d252707cb2e) ç³»åˆ—æ¨¡å‹ï¼ŒåŒ…å« 9B å’Œ 32B ä¸¤ç§æ¨¡å‹å°ºå¯¸ã€‚
- ğŸ”¥ **News**: ``2024/06/18``: æˆ‘ä»¬å‘å¸ƒ [æŠ€æœ¯æŠ¥å‘Š](https://arxiv.org/pdf/2406.12793), æ¬¢è¿æŸ¥çœ‹ã€‚
- ğŸ”¥ **News**: ``2024/06/05``: æˆ‘ä»¬å‘å¸ƒ `GLM-4-9B` ç³»åˆ—å¼€æºæ¨¡å‹ã€‚

## æ•ˆæœå±•ç¤º

### åŠ¨ç”»ç»˜åˆ¶

<table>
  <tr>
    <td style="text-align: center; font-size: 16px; font-weight: bold; padding: 10px; width: 420px;">
      GLM-4-Z1-32B-0414
    </td>
    <td style="text-align: center; font-size: 16px; font-weight: bold; padding: 10px; width: 420px;">
      GLM-4-32B-Chat-0414
    </td>
  </tr>
  <tr>
    <td style="vertical-align: top; padding: 10px; width: 420px;">
      <video src="https://github.com/user-attachments/assets/849ff9fd-b54d-4c74-9ee5-3412e1a09e32"
             style="width: 400px; height: 300px; object-fit: contain;" autoplay loop muted playsinline></video>
      <div style="margin-top: 10px; font-size: 14px; color: #333; width: 400px;">
        write a Python program that shows a ball bouncing inside a spinning hexagon. The ball should be affected by gravity and friction, and it must bounce off the rotating walls realistically
      </div>
    </td>
    <td style="vertical-align: top; padding: 10px; width: 420px;">
      <video src="https://github.com/user-attachments/assets/ff87767e-66ac-4fcb-935a-eda783d12210"
             style="width: 400px; height: 300px; object-fit: contain;" autoplay loop muted playsinline></video>
      <div style="margin-top: 10px; font-size: 14px; color: #333; width: 400px;">
         Create a first person flight simulator with threejs in HTML
      </div>
    </td>
  </tr>
</table>

### ç½‘é¡µè®¾è®¡

<table>
  <tr>
    <td style="text-align: center; font-size: 16px; font-weight: bold; padding: 10px; width: 420px;">
      GLM-4-32B-Chat-0414
    </td>
    <td style="text-align: center; font-size: 16px; font-weight: bold; padding: 10px; width: 420px;">
      GLM-4-32B-Chat-0414
    </td>
  </tr>
  <tr>
    <td style="vertical-align: top; padding: 10px; width: 420px;">
      <img src="https://github.com/user-attachments/assets/bd9c1fc1-c784-4e8f-9c76-5f7389a715f1"/>
      <div style="margin-top: 10px; font-size: 14px; color: #333; width: 400px;">
          è®¾è®¡ä¸€ä¸ªæ”¯æŒè‡ªå®šä¹‰å‡½æ•°ç»˜åˆ¶çš„ç»˜å›¾æ¿ï¼Œå¯ä»¥æ·»åŠ å’Œåˆ é™¤è‡ªå®šä¹‰å‡½æ•°ï¼Œå¹¶ä¸ºå‡½æ•°æŒ‡å®šé¢œè‰²
      </div>
    </td>
    <td style="vertical-align: top; padding: 10px; width: 420px;">
      <img src="https://github.com/user-attachments/assets/7ad12d52-9229-4278-8d1b-ffbf43e99070"/>
      <div style="margin-top: 10px; font-size: 14px; color: #333; width: 400px;"> ç»™æˆ‘è®¾è®¡ä¸€ä¸ªç§»åŠ¨ç«¯æœºå™¨å­¦ä¹ å¹³å°çš„ UIï¼Œå…¶ä¸­è¦åŒ…æ‹¬è®­ç»ƒä»»åŠ¡ï¼Œå­˜å‚¨ç®¡ç†ï¼Œå’Œä¸ªäººç»Ÿè®¡ä¿¡æ¯ç•Œé¢ã€‚ä¸ªäººä¿¡æ¯ç»Ÿè®¡ç•Œé¢è¦ç”¨å›¾è¡¨å±•ç¤ºç”¨æˆ·è¿‡å»ä¸€æ®µæ—¶é—´çš„å„ç±»èµ„æºä½¿ç”¨æƒ…å†µã€‚ä½¿ç”¨ Tailwind CSS æ¥ç¾åŒ–é¡µé¢ï¼ŒæŠŠè¿™ 3 ä¸ªæ‰‹æœºç•Œé¢å¹³é“ºå±•ç¤ºåˆ°ä¸€ä¸ª HTML é¡µé¢ä¸­ </div>
    </td>
  </tr>
</table>

### SVG ç”Ÿæˆ

<table>
  <tr>
    <td style="text-align: center; font-size: 16px; font-weight: bold; padding: 10px; width: 420px;">
      GLM-4-32B-Chat-0414
    </td>
    <td style="text-align: center; font-size: 16px; font-weight: bold; padding: 10px; width: 420px;">
      GLM-4-32B-Chat-0414
    </td>
  </tr>
  <tr>
    <td style="vertical-align: top; padding: 10px; width: 420px;">
      <img src="https://github.com/user-attachments/assets/0f884b5f-1c60-4f81-ad2c-164c4fe66e36"/>
      <div style="margin-top: 10px; font-size: 14px; color: #333; width: 400px;">
          ç”¨é»‘ç™½æ‰‹ç»˜é£æ ¼ç»™æˆ‘å±•ç¤ºæœºå™¨å­¦ä¹ çš„æœ¬è´¨ï¼Œç”»åœ¨ä¸€å¼  svg å›¾ä¸­
      </div>
    </td>
    <td style="vertical-align: top; padding: 10px; width: 420px;">
      <img src="https://github.com/user-attachments/assets/8fe70f0f-e3e3-441b-aec6-2db2b9304326"/>
      <div style="margin-top: 10px; font-size: 14px; color: #333; width: 400px;"> create an svg to illustrate the training pipeline of an LLM </div>
    </td>
  </tr>
</table>

## æ¨¡å‹åˆ—è¡¨

### GLM-4-0414 ç³»åˆ—æ¨¡å‹

|             Model             |   Type    | Seq Length* |                                                                                                                       Download                                                                                                                        |
|:-----------------------------:|:---------:|:----------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|      GLM-4-9B-Chat-0414       |   Chat    |    32K -> 128K    |                [ğŸ¤— Huggingface](https://huggingface.co/THUDM/GLM-4-9B-Chat-0414)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/GLM-4-9B-Chat-0414)<br> [ğŸ§© Modelers](https://modelers.cn/models/zhipuai/GLM-4-9B-Chat-0414)                |
|        GLM-Z1-9B-0414         | Reasoning |    32K -> 128K    |                   [ğŸ¤— Huggingface](https://huggingface.co/THUDM/GLM-4-Z1-9B-0414)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/GLM-4-Z1-9B-0414)<br> [ğŸ§© Modelers](https://modelers.cn/models/zhipuai/GLM-4-Z1-9B-0414)                   |
|        GLM-4-32B-0414         |   Base    |    32K -> 128K    |                      [ğŸ¤— Huggingface](https://huggingface.co/THUDM/GLM-4-32B-0414)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/GLM-4-32B-0414)<br> [ğŸ§© Modelers](https://modelers.cn/models/zhipuai/GLM-4-32B-0414)                      |
|      GLM-4-32B-Chat-0414      |   Chat    |    32K -> 128K    |              [ğŸ¤— Huggingface](https://huggingface.co/THUDM/GLM-4-32B-Chat-0414)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/GLM-4-32B-Chat-0414)<br> [ğŸ§© Modelers](https://modelers.cn/models/zhipuai/GLM-4-32B-Chat-0414)               |
|        GLM-Z1-32B-0414        | Reasoning |    32K -> 128K    |                 [ğŸ¤— Huggingface](https://huggingface.co/THUDM/GLM-4-Z1-32B-0414)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/GLM-4-Z1-32B-0414)<br> [ğŸ§© Modelers](https://modelers.cn/models/zhipuai/GLM-4-Z1-32B-0414)                  |
| GLM-4-Z1-Rumination-32B-0414  | Reasoning |    32K -> 128K    | [ğŸ¤— Huggingface](https://huggingface.co/THUDM/GLM-4-Z1-Rumination-32B-0414)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/GLM-4-Z1-Rumination-32B-0414)<br> [ğŸ§© Modelers](https://modelers.cn/models/zhipuai/GLM-4-Z1-Rumination-32B-0414) |

\* æ¨¡å‹åŸç”Ÿé‡‡ç”¨ 32k ä¸Šä¸‹æ–‡è¿›è¡Œè®­ç»ƒï¼Œå¯¹äºè¾“å…¥ + è¾“å‡ºé•¿åº¦å¯èƒ½è¶…è¿‡ 32k çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å»ºè®®æ¿€æ´» Yarn æ¥è·å¾—è¾ƒå¥½çš„å¤–æ¨æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®è¿›è¡Œ Yarn å¤–æ¨è®¾ç½®ï¼š

å¯¹äºæ”¯æŒçš„æ¡†æ¶ï¼Œä½ åº”è¯¥åœ¨`config.json`ä¸­ä¿®æ”¹:

```json
"rope_scaling": {
    "factor": 4.0,
    "original_max_position_embeddings": 32768,
    "type": "yarn"
}
```

### GLM-4-9B ç³»åˆ—æ¨¡å‹

|        Model        | Type | Seq Length |                                                                                                      Download                                                                                                       |
|:-------------------:|:----:|:----------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|      GLM-4-9B       | Base |     8K     |                                     [ğŸ¤— Huggingface](https://huggingface.co/THUDM/glm-4-9b)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/glm-4-9b)<br>                                                  |
|    GLM-4-9B-Chat    | Chat |    128K    |     [ğŸ¤— Huggingface](https://huggingface.co/THUDM/glm-4-9b-chat)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/glm-4-9b-chat)<br> [ğŸŸ£ WiseModel](https://wisemodel.cn/models/ZhipuAI/GLM-4-9B-Chat)      |
|  GLM-4-9B-Chat-HF   | Chat |    128K    |                                     [ğŸ¤— Huggingface](https://huggingface.co/THUDM/glm-4-9b-chat-hf)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/glm-4-9b-chat-hf)                                      |
|  GLM-4-9B-Chat-1M   | Chat |     1M     | [ğŸ¤— Huggingface](https://huggingface.co/THUDM/glm-4-9b-chat-1m)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/glm-4-9b-chat-1m)<br> [ğŸŸ£ WiseModel](https://wisemodel.cn/models/ZhipuAI/GLM-4-9B-Chat-1M) |
| GLM-4-9B-Chat-1M-HF | Chat |     1M     |                                  [ğŸ¤— Huggingface](https://huggingface.co/THUDM/glm-4-9b-chat-1m-hf)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/glm-4-9b-chat-1m-hf)                                   |
|      GLM-4V-9B      | Chat |     8K     |           [ğŸ¤— Huggingface](https://huggingface.co/THUDM/glm-4v-9b)<br> [ğŸ¤– ModelScope](https://modelscope.cn/models/ZhipuAI/glm-4v-9b)<br> [ğŸŸ£ WiseModel](https://wisemodel.cn/models/ZhipuAI/GLM-4V-9B)            |

## è¯„æµ‹ç»“æœ

### GLM-4-0414 ç³»åˆ—

| æ¨¡å‹               | IFEval  | SWE-Bench        | BFCL-v3 (Overall) | BFCL-v3 (MultiTurn) | TAU-Bench (Retail) | TAU-Bench (Airline) | SimpleQA | HotpotQA |
|------------------|---------|------------------|-------------------|---------------------|--------------------|---------------------|----------|----------|
| Qwen2.5-Max      | 85.6    | 24.4             | 50.9              | 30.5                | 58.3               | 22.0                | 79.0     | 52.8     |
| GPT-4o-1120      | 81.9    | 38.8             | 69.6              | 41.0                | 62.8               | 46.0                | 82.8     | 63.9     |
| DeepSeek-V3-0324 | 83.4    | 38.8ï¼ˆohï¼‰         | 66.2              | 35.8                | 60.7               | 32.4                | 82.6     | 54.6     |
| DeepSeek-R1      | 84.3    | 34ï¼ˆohï¼‰/ 49.2ï¼ˆalï¼‰ | 57.5              | 12.4                | 33.0               | 37.3                | 83.9     | 63.1     |
| GLM-4-32B-0414   | 86.5    |                  | 69.6              | 41.5                | 68.7               | 51.2                | 88.1     | 63.8     |

### GLM-4-9B ç³»åˆ—

#### å¯¹è¯æ¨¡å‹å…¸å‹ä»»åŠ¡

| Model               | AlignBench | MT-Bench | IFEval | MMLU | C-Eval | GSM8K | MATH | HumanEval | NaturalCodeBench |
|:--------------------|:----------:|:--------:|:------:|:----:|:------:|:-----:|:----:|:---------:|:----------------:|
| Llama-3-8B-Instruct |    6.40    |   8.00   |  68.6  | 68.4 |  51.3  | 79.6  | 30.0 |   62.2    |       24.7       |
| ChatGLM3-6B         |    5.18    |   5.50   |  28.1  | 61.4 |  69.0  | 72.3  | 25.7 |   58.5    |       11.3       |
| GLM-4-9B-Chat       |    7.01    |   8.35   |  69.0  | 72.4 |  75.6  | 79.6  | 50.6 |   71.8    |       32.2       |

#### åŸºåº§æ¨¡å‹å…¸å‹ä»»åŠ¡

| Model               | MMLU | C-Eval | GPQA | GSM8K | MATH | HumanEval |
|:--------------------|:----:|:------:|:----:|:-----:|:----:|:---------:|
| Llama-3-8B          | 66.6 |  51.2  |  -   | 45.8  |  -   |   33.5    |
| Llama-3-8B-Instruct | 68.4 |  51.3  | 34.2 | 79.6  | 30.0 |   62.2    |
| ChatGLM3-6B-Base    | 61.4 |  69.0  | 26.8 | 72.3  | 25.7 |   58.5    |
| GLM-4-9B            | 74.7 |  77.1  | 34.3 | 84.0  | 30.4 |   70.1    |

> ç”±äº `GLM-4-9B` åœ¨é¢„è®­ç»ƒè¿‡ç¨‹ä¸­åŠ å…¥äº†éƒ¨åˆ†æ•°å­¦ã€æ¨ç†ã€ä»£ç ç›¸å…³çš„ instruction æ•°æ®ï¼Œæ‰€ä»¥å°† Llama-3-8B-Instruct ä¹Ÿåˆ—å…¥æ¯”è¾ƒèŒƒå›´ã€‚

#### é•¿æ–‡æœ¬

åœ¨ 1M çš„ä¸Šä¸‹æ–‡é•¿åº¦ä¸‹è¿›è¡Œ[å¤§æµ·æé’ˆå®éªŒ](https://github.com/LargeWorldModel/LWM/blob/main/scripts/eval_needle.py)ï¼Œç»“æœå¦‚ä¸‹ï¼š

![needle](resources/eval_needle.jpeg)

åœ¨ LongBench-Chat ä¸Šå¯¹é•¿æ–‡æœ¬èƒ½åŠ›è¿›è¡Œäº†è¿›ä¸€æ­¥è¯„æµ‹ï¼Œç»“æœå¦‚ä¸‹:

<p align="center">
<img src="resources/longbench.png" alt="æè¿°æ–‡å­—" style="display: block; margin: auto; width: 65%;">
</p>

#### å¤šè¯­è¨€èƒ½åŠ›

åœ¨å…­ä¸ªå¤šè¯­è¨€æ•°æ®é›†ä¸Šå¯¹ GLM-4-9B-Chat å’Œ Llama-3-8B-Instruct è¿›è¡Œäº†æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœåŠæ•°æ®é›†å¯¹åº”é€‰å–è¯­è¨€å¦‚ä¸‹è¡¨

| Dataset     | Llama-3-8B-Instruct | GLM-4-9B-Chat |                                           Languages                                            |
|:------------|:-------------------:|:-------------:|:----------------------------------------------------------------------------------------------:|
| M-MMLU      |        49.6         |     56.6      |                                              all                                               |
| FLORES      |        25.0         |     28.8      | ru, es, de, fr, it, pt, pl, ja, nl, ar, tr, cs, vi, fa, hu, el, ro, sv, uk, fi, ko, da, bg, no |
| MGSM        |        54.0         |     65.3      |                           zh, en, bn, de, es, fr, ja, ru, sw, te, th                           |
| XWinograd   |        61.7         |     73.1      |                                     zh, en, fr, jp, ru, pt                                     |
| XStoryCloze |        84.7         |     90.7      |                           zh, en, ar, es, eu, hi, id, my, ru, sw, te                           |
| XCOPA       |        73.3         |     80.1      |                           zh, et, ht, id, it, qu, sw, ta, th, tr, vi                           |

#### å·¥å…·è°ƒç”¨èƒ½åŠ›

æˆ‘ä»¬åœ¨ [Berkeley Function Calling Leaderboard](https://github.com/ShishirPatil/gorilla/tree/main/berkeley-function-call-leaderboard) ä¸Šè¿›è¡Œäº†æµ‹è¯•å¹¶å¾—åˆ°äº†ä»¥ä¸‹ç»“æœï¼š

| Model                  | Overall Acc. | AST Summary | Exec Summary | Relevance |
|:-----------------------|:------------:|:-----------:|:------------:|:---------:|
| Llama-3-8B-Instruct    |    58.88     |    59.25    |    70.01     |   45.83   |
| gpt-4-turbo-2024-04-09 |    81.24     |    82.14    |    78.61     |   88.75   |
| ChatGLM3-6B            |    57.88     |    62.18    |    69.78     |   5.42    |
| GLM-4-9B-Chat          |    81.00     |    80.26    |    84.40     |   87.92   |

#### å¤šæ¨¡æ€èƒ½åŠ›

GLM-4V-9B æ˜¯ä¸€ä¸ªå¤šæ¨¡æ€è¯­è¨€æ¨¡å‹ï¼Œå…·å¤‡è§†è§‰ç†è§£èƒ½åŠ›ï¼Œå…¶ç›¸å…³ç»å…¸ä»»åŠ¡çš„è¯„æµ‹ç»“æœå¦‚ä¸‹ï¼š

|                            | **MMBench-EN-Test** | **MMBench-CN-Test** | **SEEDBench_IMG** | **MMStar** | **MMMU** | **MME** | **HallusionBench** | **AI2D** | **OCRBench** |
|----------------------------|---------------------|---------------------|-------------------|------------|----------|---------|--------------------|----------|--------------|
| **gpt-4o-2024-05-13**      | 83.4                | 82.1                | 77.1              | 63.9       | 69.2     | 2310.3  | 55.0               | 84.6     | 736          |
| **gpt-4-turbo-2024-04-09** | 81.0                | 80.2                | 73.0              | 56.0       | 61.7     | 2070.2  | 43.9               | 78.6     | 656          |
| **gpt-4-1106-preview**     | 77.0                | 74.4                | 72.3              | 49.7       | 53.8     | 1771.5  | 46.5               | 75.9     | 516          |
| **InternVL-Chat-V1.5**     | 82.3                | 80.7                | 75.2              | 57.1       | 46.8     | 2189.6  | 47.4               | 80.6     | 720          |
| **LLaVA-Next-Yi-34B**      | 81.1                | 79.0                | 75.7              | 51.6       | 48.8     | 2050.2  | 34.8               | 78.9     | 574          |
| **Step-1V**                | 80.7                | 79.9                | 70.3              | 50.0       | 49.9     | 2206.4  | 48.4               | 79.2     | 625          |
| **MiniCPM-Llama3-V2.5**    | 77.6                | 73.8                | 72.3              | 51.8       | 45.8     | 2024.6  | 42.4               | 78.4     | 725          |
| **Qwen-VL-Max**            | 77.6                | 75.7                | 72.7              | 49.5       | 52.0     | 2281.7  | 41.2               | 75.7     | 684          |
| **Gemini 1.0 Pro**         | 73.6                | 74.3                | 70.7              | 38.6       | 49.0     | 2148.9  | 45.7               | 72.9     | 680          |
| **Claude 3 Opus**          | 63.3                | 59.2                | 64.0              | 45.7       | 54.9     | 1586.8  | 37.8               | 70.6     | 694          |
| **GLM-4V-9B**              | 81.1                | 79.4                | 76.8              | 58.7       | 47.2     | 2163.8  | 46.6               | 81.1     | 786          |

## å®Œæ•´é¡¹ç›®åˆ—è¡¨

æœ¬å¼€æºä»“åº“é€šè¿‡ä»¥ä¸‹å†…å®¹ä¸ºå¼€å‘è€…æä¾›åŸºç¡€çš„ GLM-4 å¼€æºæ¨¡å‹ä½¿ç”¨å’Œå¼€å‘ä»£ç 

+ [inference](inference/README_zh.md)
    + ä½¿ç”¨ transformers å’Œ vLLM åç«¯çš„äº¤äº’ä»£ç 
    + OpenAI API åç«¯äº¤äº’ä»£ç 
    + Batch æ¨ç†ä»£ç 

+ [finetune](finetune/README_zh)
    + PEFT (LORA, P-Tuning) å¾®è°ƒä»£ç  (é€‚ç”¨äº 9Bæ¨¡å‹)
    + SFT å¾®è°ƒä»£ç  (é€‚ç”¨äº 9Bæ¨¡å‹)

+ [demo](demo)
    + [intel_device_demo](demo/intel_device_demo) ä½¿ç”¨ OpenVINO / ä½¿ç”¨ IntelÂ® Extension for Transformers éƒ¨ç½²æ¨¡å‹ä»£ç 
    + [composite_demo](demo/composite_demo/README.md) GLM-4-9B-Chat ä»¥åŠ GLM-4V-9B å¼€æºæ¨¡å‹çš„å®Œæ•´åŠŸèƒ½æ¼”ç¤ºä»£ç ï¼ŒåŒ…å«äº† All Tools èƒ½åŠ›ã€é•¿æ–‡æ¡£è§£è¯»å’Œå¤šæ¨¡æ€èƒ½åŠ›çš„å±•ç¤ºã€‚ä¸é€‚ç”¨äº `GLM-4-0414` æ¨¡å‹ã€‚


## æ¨¡å‹å’Œæç¤ºè¯å®ç°

### æ¨¡å‹å®ç°

å¦‚æœä½ æƒ³æŸ¥çœ‹æˆ‘ä»¬çš„æ¨¡å‹å®ç°ï¼Œæ¬¢è¿æŸ¥çœ‹åœ¨ç›¸å…³ä»“åº“çš„æ¨¡å‹å®ç°Pull Requestï¼Œä»–ä»¬å·²ç»è¢«åˆå¹¶ã€‚

+ [vLLM æ¨¡å‹å®ç°](https://github.com/vllm-project/vllm/pull/16338)
+ [transformers æ¨¡å‹å®ç°](https://github.com/huggingface/transformers/pull/37388)
+ [llama.cpp æ¨¡å‹å®ç°](https://github.com/ggml-org/llama.cpp/pull/12867)

### æç¤ºè¯å®ç°

å¦‚æœä½ ä½¿ç”¨`transformers`åº“æä¾›çš„`apply_chat_template`æ–¹æ³•æ„å»ºæç¤ºè¯ã€‚ä»¥ä¸‹æ˜¯å¯¹ä¸åŒ GLM-4-0414 æ¨¡å‹ä¸­ `ç³»ç»Ÿæç¤ºè¯`çš„é™åˆ¶ã€‚

+ `GLM-4-32B-0414`: åŸºåº§æ¨¡å‹ï¼Œæ— å¯¹è¯æ¨¡æ¿ã€‚
+ `GLM-4-*-Chat-0414` / `GLM-4-Z1-*-0414`: å¦‚æœä¼ å…¥`tools`ï¼Œåˆ™ç”± `apply_chat_template` å¡«å……å·¥å…·åˆ°`chat_template`ä¸­çš„å›ºå®šæ¨¡æ¿ï¼Œå•ç‹¬ä½œä¸ºä¸€æ¡å¸¦æœ‰`tools`ç»‘å®šçš„ `system`å­—æ®µä¿¡æ¯å¹¶æ‹¼æ¥äº`messages[0]`ã€‚åŸæœ¬ä¼ å…¥çš„æ‰€æœ‰`messages` è‡ªåŠ¨å¾€åç§»åŠ¨ä¸€ä¸ªä½ç½®ã€‚
+ `GLM-4-DR-32B-0414`:
    + ä¸æ”¯æŒè‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰å·¥å…·ï¼Œä½ çš„æ‰€æœ‰ `tools` å’Œ `system` å­—æ®µä¼šè¢« `apply_chat_template` å¿½ç•¥ã€‚
    + ä¸€å…±æ”¯æŒå››ä¸ªå·¥å…·ï¼Œåˆ†åˆ«æ˜¯
        ```
        1. search
           æè¿°: æ‰§è¡Œæœç´¢æŸ¥è¯¢å¹¶è¿”å›æœç´¢ç»“æœã€‚å½“æ‚¨éœ€è¦æŸ¥æ‰¾æœ‰å…³ç‰¹å®šä¸»é¢˜çš„ä¿¡æ¯æ—¶ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚
           å‚æ•°: query (å­—ç¬¦ä¸²) - æœç´¢æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œé™¤éæ˜¯ä¸­æ–‡ä¸“æœ‰åè¯ï¼Œå¦åˆ™ä½¿ç”¨è‹±æ–‡å•è¯

        2. click
           æè¿°: ç‚¹å‡»æœç´¢ç»“æœä¸­çš„é“¾æ¥å¹¶å¯¼èˆªåˆ°ç›¸åº”é¡µé¢ã€‚å½“æ‚¨éœ€è¦æŸ¥çœ‹ç‰¹å®šæœç´¢ç»“æœçš„è¯¦ç»†å†…å®¹æ—¶ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚
           å‚æ•°: link_id (æ•´æ•°) - è¦ç‚¹å‡»çš„é“¾æ¥IDï¼ˆæ¥è‡ªæœç´¢ç»“æœä¸­çš„åºå·ï¼‰

        3. open
           æè¿°: æ‰“å¼€ç‰¹å®šç½‘ç«™ã€‚é€šè¿‡URLè·å–ä»»ä½•ç½‘ç«™çš„å†…å®¹ã€‚
           å‚æ•°: url (å­—ç¬¦ä¸²) - ç›®æ ‡ç½‘ç«™URLæˆ–åŸŸå

        4. finish
           æè¿°: å®Œæˆä»»åŠ¡ã€‚å½“æ‚¨å·²æ‰¾åˆ°æ‰€éœ€ä¿¡æ¯æ—¶ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚
           å‚æ•°: æ— 
        ```

    + `chat_template`ä¸­çš„å›ºå®šæ¨¡æ¿ä½¿ç”¨è‹±è¯­æç¤ºè¯ï¼Œé»˜è®¤åªæ”¯æŒè‹±è¯­ï¼Œæƒ³æ›´æ¢å…¶ä»–è¯­è¨€ï¼Œéœ€è¦ä¿®æ”¹ä»¥ä¸‹éƒ¨åˆ†
        ```
        <é‡è¦é…ç½®>
        - é‡‡ç”¨è¯­è¨€
            * æœç´¢å…³é”®è¯ï¼šè‹±è¯­ -> åœ¨è¿™é‡Œæ¢æˆä¸­æ–‡æˆ–è€…å…¶ä»–è¯­è¨€
            * æ€è€ƒï¼šè‹±è¯­ -> åœ¨è¿™é‡Œæ¢æˆä¸­æ–‡æˆ–è€…å…¶ä»–è¯­è¨€
        ```

GLM-4-0414 ç³»åˆ—æ¨¡å‹çš„æç¤ºè¯æ„é€ å¯ä»¥å‰å¾€å¯¹åº”çš„æ¨¡å‹ä»“åº“ä¸­çš„ `chat_template.jinja` æŸ¥çœ‹å…·ä½“çš„æ¨¡å‹å¯¹è¯æ¨¡æ¿ã€‚

## å‹æƒ…é“¾æ¥

+ [LLaMA-Factory](https://github.com/hiyouga/LLaMA-Factory): é«˜æ•ˆå¼€æºå¾®è°ƒæ¡†æ¶ï¼Œæ”¯æŒ`GLM-4-0414`, `GLM-4` ç³»åˆ—æ¨¡å‹çš„å¾®è°ƒã€‚
+ [SWIFT](https://github.com/modelscope/swift): é­”æ­ç¤¾åŒºçš„å¤§æ¨¡å‹/å¤šæ¨¡æ€å¤§æ¨¡å‹è®­ç»ƒæ¡†æ¶ï¼Œå·²æ”¯æŒ GLM-4-9B-Chat / GLM-4V-9B æ¨¡å‹å¾®è°ƒã€‚
+ [Xorbits Inference](https://github.com/xorbitsai/inference): æ€§èƒ½å¼ºå¤§ä¸”åŠŸèƒ½å…¨é¢çš„åˆ†å¸ƒå¼æ¨ç†æ¡†æ¶ï¼Œè½»æ¾ä¸€é”®éƒ¨ç½²ä½ è‡ªå·±çš„æ¨¡å‹æˆ–å†…ç½®çš„å‰æ²¿å¼€æºæ¨¡å‹ã€‚
+ [LangChain-ChatChat](https://github.com/chatchat-space/Langchain-Chatchat): åŸºäº Langchain ä¸ ChatGLM ç­‰è¯­è¨€æ¨¡å‹çš„ RAG ä¸ Agent åº”ç”¨
+ [self-llm](https://github.com/datawhalechina/self-llm/tree/master/models/GLM-4): Datawhale å›¢é˜Ÿçš„æä¾›çš„ GLM-4-9B ç³»åˆ—æ¨¡å‹ä½¿ç”¨æ•™ç¨‹ã€‚
+ [chatglm.cpp](https://github.com/li-plus/chatglm.cpp): ç±»ä¼¼ llama.cpp çš„é‡åŒ–åŠ é€Ÿæ¨ç†æ–¹æ¡ˆï¼Œå®ç°ç¬”è®°æœ¬ä¸Šå®æ—¶å¯¹è¯
+ [OpenVINO](https://github.com/openvinotoolkit): Intel å¼€å‘çš„é«˜æ€§èƒ½ CPU,GPUåŠNPU åŠ é€Ÿæ¨ç†æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒæ­¤ [æ­¥éª¤](https://github.com/openvinotoolkit/openvino_notebooks/blob/latest/notebooks/llm-chatbot/llm-chatbot-generate-api.ipynb) éƒ¨ç½² glm-4-9b-chat æ¨¡å‹ã€‚


## å¼•ç”¨

å¦‚æœä½ è§‰å¾—æˆ‘ä»¬çš„å·¥ä½œæœ‰å¸®åŠ©çš„è¯ï¼Œè¯·è€ƒè™‘å¼•ç”¨ä¸‹åˆ—è®ºæ–‡ã€‚

```
@misc{glm2024chatglm,
      title={ChatGLM: A Family of Large Language Models from GLM-130B to GLM-4 All Tools},
      author={Team GLM and Aohan Zeng and Bin Xu and Bowen Wang and Chenhui Zhang and Da Yin and Diego Rojas and Guanyu Feng and Hanlin Zhao and Hanyu Lai and Hao Yu and Hongning Wang and Jiadai Sun and Jiajie Zhang and Jiale Cheng and Jiayi Gui and Jie Tang and Jing Zhang and Juanzi Li and Lei Zhao and Lindong Wu and Lucen Zhong and Mingdao Liu and Minlie Huang and Peng Zhang and Qinkai Zheng and Rui Lu and Shuaiqi Duan and Shudan Zhang and Shulin Cao and Shuxun Yang and Weng Lam Tam and Wenyi Zhao and Xiao Liu and Xiao Xia and Xiaohan Zhang and Xiaotao Gu and Xin Lv and Xinghan Liu and Xinyi Liu and Xinyue Yang and Xixuan Song and Xunkai Zhang and Yifan An and Yifan Xu and Yilin Niu and Yuantao Yang and Yueyan Li and Yushi Bai and Yuxiao Dong and Zehan Qi and Zhaoyu Wang and Zhen Yang and Zhengxiao Du and Zhenyu Hou and Zihan Wang},
      year={2024},
      eprint={2406.12793},
      archivePrefix={arXiv},
      primaryClass={id='cs.CL' full_name='Computation and Language' is_active=True alt_name='cmp-lg' in_archive='cs' is_general=False description='Covers natural language processing. Roughly includes material in ACM Subject Class I.2.7. Note that work on artificial languages (programming languages, logics, formal systems) that does not explicitly address natural-language issues broadly construed (natural-language processing, computational linguistics, speech, text retrieval, etc.) is not appropriate for this area.'}
}
```

```
@misc{wang2023cogvlm,
      title={CogVLM: Visual Expert for Pretrained Language Models},
      author={Weihan Wang and Qingsong Lv and Wenmeng Yu and Wenyi Hong and Ji Qi and Yan Wang and Junhui Ji and Zhuoyi Yang and Lei Zhao and Xixuan Song and Jiazheng Xu and Bin Xu and Juanzi Li and Yuxiao Dong and Ming Ding and Jie Tang},
      year={2023},
      eprint={2311.03079},
      archivePrefix={arXiv},
      primaryClass={cs.CV}
}
```
